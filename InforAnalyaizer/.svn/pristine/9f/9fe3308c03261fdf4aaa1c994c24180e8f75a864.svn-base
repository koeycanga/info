<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="utf-8"%>
<%@ taglib prefix="ss" uri="http://www.springframework.org/tags" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<fmt:setBundle basename="resources" var="sysInfo" />
<fmt:message key="front_menu" var="front_menu" bundle="${sysInfo}" />
<fmt:message key="W0003" var="W0003" bundle="${sysInfo}" />
<fmt:message key="E0004" var="E0004" bundle="${sysInfo}" />
<fmt:message key="E0014" var="E0014" bundle="${sysInfo}" />
<fmt:message key="E0025" var="E0025" bundle="${sysInfo}" />
<fmt:message key="I0011" var="I0011" bundle="${sysInfo}" />  
<fmt:message key="I0012" var="I0012" bundle="${sysInfo}" />
<fmt:message key="I0013" var="I0013" bundle="${sysInfo}" /> 
<fmt:message key="W0002" var="W0002" bundle="${sysInfo}" /> 
<fmt:message key="E0022" var="E0022" bundle="${sysInfo}" /> 
<fmt:message key="I0008" var="I0008" bundle="${sysInfo}" />
<fmt:message key="I0013" var="I0013" bundle="${sysInfo}" /> 
<fmt:message key="I0014" var="I0014" bundle="${sysInfo}" />
<fmt:message key="E0029" var="E0029" bundle="${sysInfo}" />
<fmt:message key="E0030" var="E0030" bundle="${sysInfo}" />
<fmt:message key="I0017" var="I0017" bundle="${sysInfo}" />
<fmt:message key="I0018" var="I0018" bundle="${sysInfo}" />
<fmt:message key="I0019" var="I0019" bundle="${sysInfo}" />
<fmt:message key="E0031" var="E0031" bundle="${sysInfo}" /> 
<fmt:message key="E0019" var="E0019" bundle="${sysInfo}" />     
<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>竞争情报分析系统</title>
<link rel="stylesheet" type="text/css" href="${ctx}/css/cy_CIAS_style.css">
</head>

<body style="background-color: #f2f3f8;">
<div id="app" v-cloak>
<div class="cy_hidebg" id="cy_hidebg"></div>
<!--头部-->
<div class="cy_CIASFE_top">
	<div class="cy_CIASFE_logo"><img src="${ctx}/image/fontend-logo.png"></div>
	<div class="cy_CIASFE_tit">国药器械-竞争情报分析系统</div>
	<ic_top_menu></ic_top_menu> <!-- 上部菜单栏 -->
	<ic_user_info ref="ic_user_info"></ic_user_info> <!-- 登录用户信息框 -->
</div>

<!--左侧数据-->
<div class="cy_CIAFE_main">
	<div class="cy_CIASFE_intmonbody">
		<!--  <div class="cy_CIASFE_intmonbodyleft">
			<div class="cy_CIASFE_monpltop">监测方案<a href="#"><img src="${ctx}/image/monplan-plus.png" v-on:click="NewJCFA()"></a></div>
			
			<div v-for="(fndata,index) in fa_name_datas" class="cy_CIASFE_monplan">
			    <div class="cy_CIASFE_monplantit">{{fndata.planName}}</div><a href="#"><img src="${ctx}/image/monplan-edit.png"></a><a href=""><img src="${ctx}/image/monplan-dele.png"></a>
			</div>
			
		</div>	 -->
	<ic_jcfa></ic_jcfa>
	
	<div class="cy_CIASFE_intmonbodyright">
	
<!--条件筛选-->
		<div class="cy_CIASFE_search">
			<select><option>全文匹配</option></select>
			<div class="cy_CMICBMS_schbox01"><input v-model="search_key" type="text" placeholder="请输入…" style="cursor: text"></div>
			<input type="button" class="cy_CMICBMS_schbtn" value="检索">
		</div>
		<div class="cy_CIASFE_condition01">
			<div class="cy_CIASFE_conbox04">
				<a href=""><div class="cy_CIASFE_conbox05">信息汇总</div></a>
				<a href=""><div class="cy_CIASFE_conbox06">内容分析</div></a>
				<a href=""><div class="cy_CIASFE_conbox06">传播分析</div></a>
			</div>
			<div class="cy_CIASFE_conbox01">监测时间：
			    <input value="0" type="radio" name="montime" v-model="montime"  id="montime_0" style="display: none;" checked><label for="montime_0">今天</label>
				<input value="-1" type="radio" name="montime" v-model="montime"  id="montime_1" style="display: none;"><label for="montime_1">24小时</label>
           		<input value="-2" type="radio" name="montime" v-model="montime"  id="montime_2" style="display: none;"><label for="montime_2">2天</label>
           		<input value="-3" type="radio" name="montime" v-model="montime"  id="montime_3" style="display: none;"><label for="montime_3">3天</label>
           		<input value="-7" type="radio" name="montime" v-model="montime"  id="montime_4" style="display: none;"><label for="montime_4">7天</label>
           		<input value="-10" type="radio" name="montime" v-model="montime" id="montime_5" style="display: none;"><label for="montime_5">10天</label>
           		<input value="10" type="radio" name="montime" v-model="montime"  id="montime_6" style="display: none;"><label for="montime_6">自定义</label><input id="fromdate" type="date" class="cy_CIASFE_timetb">—<input id="todate" type="date" class="cy_CIASFE_timetb"><input type="button" class="cy_CMICBMS_schbtn" value="确认">
            </div>
		  <div class="cy_CIASFE_conbox02">
				<div class="cy_CIASFE_conbox03">
				情感分析：
					<input value="-1" type="radio" name="emoana" v-model="emoana" id="emoana_0" style="display: none;" checked><label for="emoana_0">全部</label>
					<input value="0" type="radio" name="emoana" v-model="emoana"  id="emoana_1" style="display: none;"><label for="emoana_1">正面</label>
					<input value="1" type="radio" name="emoana" v-model="emoana"  id="emoana_2" style="display: none;"><label for="emoana_2">中性</label>
					<input value="2" type="radio" name="emoana" v-model="emoana"  id="emoana_3" style="display: none;"><label for="emoana_3">负面</label>
				</div>
				<div class="cy_CIASFE_conbox03">相似文章：
					<input value="0" type="radio" name="simart" v-model="simart"  id="simart_0" style="display: none;" checked><label for="simart_0">合并</label>
					<input value="1" type="radio" name="simart" v-model="simart"  id="simart_1" style="display: none;"><label for="simart_1">不合并</label>
				</div>
			</div>
		  <div class="cy_CIASFE_conbox02">
				<div class="cy_CIASFE_conbox03">排序方式： 
					<input type="radio" name="sort" v-model="sort" value="0" id="sort_0" style="display: none;" checked><label for="sort_0">时间降序</label>
					<input type="radio" name="sort" v-model="sort" value="1" id="sort_1" style="display: none;"><label for="sort_1">时间升序</label>
					<input type="radio" name="sort" v-model="sort" value="2" id="sort_2" style="display: none;"><label for="sort_2">权重降序</label>
					<input type="radio" name="sort" v-model="sort" value="3" id="sort_3" style="display: none;"><label for="sort_3">热度排序</label>
				</div>
				<div class="cy_CIASFE_conbox03">信息来源：
					<input type="radio" name="infsour" v-model="infsour" value="-1" id="infsour_0" style="display: none;" checked><label for="infsour_0">全部</label>
					<input type="radio" name="infsour" v-model="infsour" value="0" id="infsour_1" style="display: none;"><label for="infsour_1">新闻</label>
					<input type="radio" name="infsour" v-model="infsour" value="1" id="infsour_2" style="display: none;"><label for="infsour_2">微博</label>
					<input type="radio" name="infsour" v-model="infsour" value="2" id="infsour_3" style="display: none;"><label for="infsour_3">微信</label>
					<input type="radio" name="infsour" v-model="infsour" value="3" id="infsour_4" style="display: none;"><label for="infsour_4">论坛</label>
					<input type="radio" name="infsour" v-model="infsour" value="4" id="infsour_5" style="display: none;"><label for="infsour_5">博客</label>
				</div>
			</div>
	  </div>
	  
<!--	内容-->
	<!--	空数据-->
		<div class="cy_CIASFE_ctnodata">
			<img src="${ctx}/image/fontend-nodata.png">
		</div>
	<!--	详细-->
		<div class="cy_CIASFE_content">
			<div class="cy_CIASFE_contentbox01">
				<label><input type="checkbox" v-model="checked" v-on:click="changeAllChecked()" class="cy_CIASFE_contentall">全选</label>
				
				<input type="button" value="删除" v-on:click="delarticle()" class="cy_CIASFE_contentbtn01">
				<input type="button" value="预警" v-on:click="toyj()" class="cy_CIASFE_contentbtn01">
			</div>
		</div>
		<div v-if="lastest_news>0" class="cy_CIASFE_prompt">
			您有<span>{{lastest_news}}</span>条新信息，点击查看
		</div>
		<div class="cy_CIASFE_contmain">
		
		<div v-for="(data,index) in datas" class="cy_CIASFE_contpaste" style="border-top: 0px;">
			<div class="cy_CIASFE_contpastetit">
				<label><input type="checkbox" v-bind:value="data.article_ID"  v-model="checkedNames">
				<b>{{data.articleTitle}}</b></label>
				<div v-if="data.emotionDivision=='2'" class="cy_CIASFE_contpassta01">负</div>
				<div v-if="data.earlyWarningState=='1'" class="cy_CIASFE_contpassta01">已预警</div>
				<div class="cy_CIASFE_contpascol">
					<div class="cy_CIASFE_colle">
						<div class="cy_CIASFE_collebox">
							<div>我的收藏</div>
							<a href="">产品</a>
							<a href="">开发</a>
							<a href="">测试</a>
						</div>
					</div>
					<div class="cy_CIASFE_share"></div>
					<div v-on:click="del_a_article(data.article_ID)" class="cy_CIASFE_dele"></div>
				</div>
				
			</div>
			<div class="cy_CIASFE_contpastecon">
				{{data.articleAbstract}}
			</div>
			<div class="cy_CIASFE_contpastfoot"><div class="cy_CIASFE_simart">相似文章：10条
				<div class="cy_CIASFE_simartbox">
					<a href="">进店想退世界杯套餐？华帝员工：老板跑了在讨薪</a><br>
					<a href="">进店想退世界杯套餐？华帝员工：老板跑了在讨薪</a><br>
					<a href="">进店想退世界杯套餐？华帝员工：老板跑了在讨薪</a><br>
					<a href="">进店想退世界杯套餐？华帝员工：老板跑了在讨薪</a><br>
					<a href="">进店想退世界杯套餐？华帝员工：老板跑了在讨薪</a><br>
					<a href="">进店想退世界杯套餐？华帝员工：老板跑了在讨薪</a>
				</div></div>
			<a v-bind:href="data.articleURL">{{data.releasetime}} {{data.websiteName}}</a>
			</div>
			
		</div>
		
		<div ></div>
<!--		分页-->
		 <pager ref="pagecomponent"></pager>  <!-- ref 固定为 pagecomponent  -->
		 
		
		</div>
	</div>
</div>	

</div>
<!--	新增-->



	
<div class="cy_CIASFE_footer02"><a href="">使用手册</a>&nbsp;&nbsp;&nbsp;&nbsp;联系我们（电话：1648726161  邮箱：sales@ichangyun.com）    Copyright&copy;2018-2021 &nbsp;&nbsp;&nbsp;&nbsp;湖北畅云时讯软件技术有限公司版权所有</div>
</div>
</body>
<script type="text/javascript" src="${ctx}/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="${ctx}/layer/layer.js"></script>
<script type="text/javascript" src="${ctx}/js/echarts.min.js"></script>
<script type="text/javascript" src="${ctx}/js/echarts-wordcloud.min.js"></script>
<script type="text/javascript" src="${ctx}/js/vue.min.js"></script>
<script type="text/javascript" src="${ctx}/js/axios.min.js"></script>
<script type="text/javascript" src="${ctx}/js/polyfill.min.js"></script>
<script type="text/javascript" src="${ctx}/js/ic_components.js"></script>
<script type="text/javascript" src="${ctx}/js/comm.js"></script>

<script>

var Info = {
	  W0003:'${W0003}',
	  E0004:'${E0004}',
	  E0014:'${E0014}',
	  E0025:'${E0025}',
	  I0011:'${I0011}',
	  I0012:'${I0012}',
	  I0013:'${I0013}',
	  W0002:'${W0002}',
	  E0022:'${E0022}',
	  I0008:'${I0008}',
	  I0013:'${I0013}',
	  I0014:'${I0014}',
	  E0030:'${E0030}',
	  I0017:'${I0017}',
	  I0018:'${I0018}',
	  E0029:'${E0029}',
	  E0031:'${E0031}',
	  I0019:'${I0019}',
	  E0019:'${E0019}'
};


var menu_datas = JSON.parse('${front_menu}');  //菜单数据来源于 classes/resources.properties

Vue.component('ic_top_menu',ic_top_menu);   // ic_top_menu 引自 js/ic_component.js

Vue.component('ic_user_info',ic_user_info);  // ic_user_info 引自 js/ic_component.js

Vue.component('ic_jcfa',ic_jcfa);  // ic_jcfa 引自 js/ic_component.js

var ic_front_pager = {
        template:'<div  class="cy_CIASFE_ctpage">'+
			'<div v-if="pageBean.rowCount>0" class="cy_CIASFE_ctpg"><div class="cy_CIASFE_ctpg01">共{{pageBean.rowCount}}条</div>'+
				'<div class="cy_CIASFE_ctpg02">'+
			    '<ul >'+
			    '<li ><a href="#" v-bind:disabled="pageBean.pageNow==1" v-on:click="showPagePre($event)">上一页</a></li>'+
				'<li v-for="ys in ysdatas" v-bind:class="{cy_CIASFE_ctpgfc:ys==pageBean.pageNow}"><a href="#"  v-on:click="showPage(ys,$event)" v-text="ys"></a></li>'+
				'<li style="border-right: 1px solid #e0e0e0"><a href="#"  v-on:click="showPageNext($event)">下一页</a></li></ul></div>'+
				'<div class="cy_CIASFE_ctpg03">到第<input type="text" v-model="pageBean.jump_page" class="cy_CIASFE_pgbox">页<input v-on:click="showJumpPage($event)" type="button" value="确定" class="cy_CIASFE_pgbtn"></div>'+
			'</div>'+
		'</div>',
			
		 props:['model'],
		 data:function(){
		     return {
				 pageBean:{
				     pageNow:1,              //当前第几页
					 pageSize:10,            //总页数
					 rowCount:0,             //总条目数
					 rowSize:[10,20,30,40],              //每页显示条目数
					 jr_rowCount:0  ,        //金融计数法的总条目数
					 row_show_start:0,       //从第几条开始显示
					 row_show_end:0,         //显示到第几条
					 rs_selected:10,          //选中的是哪一条  每页显示条目数
					 jump_page:1              //跳转框的页数
				 },
				 ysdatas : [],
				 max_length:6                //有多少个页面框框
			 }
		 },
		 methods:{
		     showPage:function(index,event){
		    	 event.preventDefault();
		    	
		    	 if(index!='...'){
				     this.pageBean.pageNow = index;
					 this.pageBean.jump_page = index;
					 //this.$parent.clear();
					 if(this.model==null){
						 this.$parent.search(this.pageBean);
					 }else {
						 var f = eval("this.$parent."+this.model);
						 new f(this.pageBean);
					 }
		    	 }
			 },
			 showFirstPage:function(event){
				
			      if(this.pageBean.pageNow>1){
				     this.showPage(1,event);
				  }else{
					  event.preventDefault();
				  }
			 },
		     showLastPage:function(event){
				 if(this.pageBean.pageNow<this.pageBean.pageSize){
			         this.showPage(this.pageBean.pageSize,event);
				 }else{
					  event.preventDefault();
				  }
			 },
			 showPagePre:function(event){
			     if(this.pageBean.pageNow>1){
				     this.pageBean.pageNow-=1;
					 this.showPage(this.pageBean.pageNow,event);
				 }else{
					  event.preventDefault();
				  }
			 },
			 showPageNext:function(event){
			    if(this.pageBean.pageNow<this.pageBean.pageSize){
				     this.pageBean.pageNow+=1;
					 this.showPage(this.pageBean.pageNow,event);
				}else{
					  event.preventDefault();
				  }
			 },
			 showJumpPage:function(event){
			     if(this.pageBean.jump_page>=1&&this.pageBean.jump_page<=this.pageBean.pageSize){
				     this.showPage(parseInt(this.pageBean.jump_page),event);
				 }else{
					  event.preventDefault();
				  }
			 },
			 schange:function(event){
			    this.pageBean.pageSize = parseInt(Math.ceil(this.pageBean.rowCount / this.pageBean.rs_selected)) ;
			    this.showPage(1,event);
			 },
			 dealAfterSearch:function(rowCount){
				this.pageBean.rowCount = rowCount;
				this.pageBean.jr_rowCount = (rowCount+"").replace(/[0-9]+?(?=(?:([0-9]{3}))+$)/g,function(a){return a+','});
 				this.pageBean.pageSize =  parseInt(Math.ceil(this.pageBean.rowCount / this.pageBean.rs_selected));
 				if(this.pageBean.rowCount=='0'){
 					this.pageBean.row_show_start = 0;
 				}else{
 					this.pageBean.row_show_start = (this.pageBean.pageNow-1)*this.pageBean.rs_selected+1;
 				}
 				this.pageBean.row_show_end = this.pageBean.pageNow*this.pageBean.rs_selected;
 				if(this.pageBean.row_show_end>this.pageBean.rowCount){
 					this.pageBean.row_show_end = this.pageBean.rowCount;
 				}
 				
 				this.ysdatas = [];
				if(this.pageBean.pageSize<=this.max_length){
					for(var i=1;i<=this.pageBean.pageSize;i++){
						this.ysdatas.push(i);
					}
				}else if(this.pageBean.pageSize - this.pageBean.pageNow<=this.max_length-1){
					var start = this.pageBean.pageSize - this.max_length + 1;
					for(var i=start;i<=this.pageBean.pageSize;i++){
						this.ysdatas.push(i);
					}
				}else{
					var lg = this.pageBean.pageNow + (this.max_length-3); 
					for(var i=this.pageBean.pageNow;i<=lg;i++){
						this.ysdatas.push(i);
					}
					this.ysdatas.push('...');
					this.ysdatas.push(this.pageBean.pageSize);
				}
			 }
			 
		 }
  };

var app = new Vue({
	
	el:"#app",
	data:{
	  checked: false,      //复选框相关
      checkedNames: [],    //复选框相关
	  checkedArr: [],      //复选框相关
	  lastest_news:0,     //有多少条新消息
	  datas:[],
	  search_key:'',
	  montime:'0',  //监测时间
	  emoana:'-1',  //情感分析
	  simart:'0',    //相似文章是否合并
	  sort:'0',     //排序方式
	  infsour:'-1'  //信息来源
	},
	  components:{
		     'pager':ic_front_pager
		  }, 
		  
	methods:{
		 changeAllChecked:function(){
			  if (!this.checked) {
					this.checkedNames = this.checkedArr;
				} else {
					this.checkedNames = [];
				}
		  },
		  del_a_article:function(article_ID){
			  var _this = this;
			  var arr = [];
			  arr.push(article_ID);
			  layer.confirm(Info.W0002, {
		            btn : [ '确定', '取消' ]//按钮
		        }, function(index) {
		            layer.close(index);
		            var json = createJSON(arr);   //createJSON() 引自js/comm.js
		            _this.checkedNames = [];
					 axios.post('../thematicmonitoring/delarticle',
							 {
							 json:json
					      })
		    			.then(function (response) {
		    				if(response.data=='ok'){
		    					_this.search(_this.$refs.pagecomponent.pageBean);
		    				}
		    				if(response.data=='nok'){
		    					layer.msg(Info.E0022);
		    				}
		    			})
		    			.catch(function (error) {
		    			    console.log(error);
		    			});
		        }); 
		  },
		  delarticle:function(){
			  if(this.checkedNames.length==0){
				  layer.msg(Info.E0019);
			  }else{
				  var _this = this;
				  layer.confirm(Info.W0002, {
			            btn : [ '确定', '取消' ]//按钮
			        }, function(index) {
			            layer.close(index);
			            var json = createJSON(_this.checkedNames);   //createJSON() 引自js/comm.js
			            _this.checkedNames = [];
						 axios.post('../thematicmonitoring/delarticle',
								 {
								 json:json
						      })
			    			.then(function (response) {
			    				if(response.data=='ok'){
			    					_this.search(_this.$refs.pagecomponent.pageBean);
			    				}
			    				if(response.data=='nok'){
			    					layer.msg(Info.E0022);
			    				}
			    			})
			    			.catch(function (error) {
			    			    console.log(error);
			    			});
			        }); 
			  }
		  },
		  toyj:function(){
			  if(this.checkedNames.length==0){
				  
				  layer.msg(Info.E0031);
				  
			  }else{
				  var _this = this;
				  var json = createJSON(this.checkedNames);
				  axios.post('../thematicmonitoring/toyj',
			   			    {
					 			 json:json
			   				}
			   			)
			   			.then(function (response) {
			   				 if(response.data=="ok"){
			   					_this.search(_this.$refs.pagecomponent.pageBean);
			   				 }
			   				 if(response.data=="nok"){
			   					layer.msg(Info.E0022);
			   				 }
			   			})
			   			.catch(function (error) {
			   				layer.msg(Info.E0022);
			   			});
			  }
		  }
	},
	watch: {
		"checkedNames": function() {
			if (this.checkedNames.length != this.checkedArr.length||this.checkedNames.length==0) {
				this.checked = false;
			} else {
				this.checked = true;
			}
		}
	 },
	computed:{
		search:function(){
	        return function(pageBean){
	        
	        	if(this.montime=='10'){
	        		this.montime = $("#fromdate").val()+"-"+$("#todate").val();
	        	}
	        	
	        	var _this = this;
	        	layer.msg(Info.I0011, {
	        		  icon: 16
	        		  ,shade: 0.01
	        		});
	    		axios.get('../thematicmonitoring/search',{
	    			params: {
	    				search_key:_this.search_key.trim(),
	    				montime:_this.montime,
	    				emoana:_this.emoana,
	    				simart:_this.simart,
	    				sort:_this.sort,
	    				infsour:_this.infsour,
	    				pageNow:pageBean.pageNow,
	    				rowSize:pageBean.rs_selected,
	    				}
	    			})
	    			.then(function (response) {
	    				
	    				var data = JSON.parse(response.data);
	    			
	    				_this.$refs.pagecomponent.dealAfterSearch(data.rowCount); 
	    				
	    				_this.datas = data.resdata;
	    				
	    				for(var i=0;i<_this.datas.length;i++){
	    					_this.checkedArr.push(_this.datas[i].article_ID);
	    				}
	    			
	    				
	    				layer.closeAll();
	    			})
	    			.catch(function (error) {
	    			    console.log(error);
	    			});
				
			}
		}
	  },
	  mounted:function(){
		  
		  this.search(this.$refs.pagecomponent.pageBean);
		  
	  }
	
	
});

</script>
</html>
