<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="utf-8"%>
<%@ taglib prefix="ss" uri="http://www.springframework.org/tags" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<fmt:setBundle basename="resources" var="sysInfo" />
<fmt:message key="front_menu" var="front_menu" bundle="${sysInfo}" /> 
<fmt:message key="W0003" var="W0003" bundle="${sysInfo}" />
<fmt:message key="E0004" var="E0004" bundle="${sysInfo}" />
<fmt:message key="E0014" var="E0014" bundle="${sysInfo}" />
<fmt:message key="E0025" var="E0025" bundle="${sysInfo}" />  
<fmt:message key="I0011" var="I0011" bundle="${sysInfo}" /> 
<fmt:message key="I0012" var="I0012" bundle="${sysInfo}" />
<fmt:message key="I0013" var="I0013" bundle="${sysInfo}" />
<fmt:message key="I0019" var="I0019" bundle="${sysInfo}" />
<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>竞争情报分析系统</title>
<link rel="stylesheet" type="text/css" href="${ctx}/css/cy_CIAS_style.css">
</head>

<body style="background-color: #f2f3f8;">
<div id="app">
<!--复制成功提示-->
<div class="cy_CIASFE_copytip">文字链接已复制</div>

<!--头部-->
<div class="cy_CIASFE_top">
	<div class="cy_CIASFE_logo"><img src="${ctx}/image/fontend-logo.png"></div>
	<div class="cy_CIASFE_tit">国药器械-竞争情报分析系统</div>
	<ic_top_menu ></ic_top_menu> <!-- 上部菜单栏 -->
	<ic_user_info></ic_user_info> <!-- 登录用户信息框 -->
</div>

<!--二级导航-->
<div class="cy_CIASFE_2ndmenu">
	<div class="cy_CIASFE_2ndmenutabchk">综合监测</div>
	<div class="cy_CIASFE_2ndmenutab">公司舆情<img src="${ctx}/image/fontend-newtip.png"></div>
	<div class="cy_CIASFE_2ndmenutab">高管舆情<img src="${ctx}/image/fontend-newtip.png"></div>
	<div class="cy_CIASFE_2ndmenutab">市场动向<img src="${ctx}/image/fontend-newtip.png"></div>
	<div class="cy_CIASFE_2ndmenutab">国家政策<img src="${ctx}/image/fontend-newtip.png"></div>
	<div class="cy_CIASFE_2ndmenutab">竞争对手<img src="${ctx}/image/fontend-newtip.png"></div>
	<div class="cy_CIASFE_2ndmenutab">产品技术<img src="${ctx}/image/fontend-newtip.png"></div>
	<div class="cy_CIASFE_2ndmenutab">上下游企业<img src="${ctx}/image/fontend-newtip.png"></div>
	<div class="cy_CIASFE_2ndmenutab" style="border: solid 1px #e0e0e0">国家政策<img src="${ctx}/image/fontend-newtip.png"></div>
</div>

<!--左侧数据-->
<div class="cy_CIAFE_main">
	<div class="cy_CIASFE_intmonbody">
	<div class="cy_CIASFE_intmonbodyleft">
		<table cellspacing="0">
			<tbody>
    <tr>
      <th width="30%">名称</th>
      <th width="30%">今天总数</th>
      <th width="40%">昨天总数</th>
    </tr>
    <tr>
      <td>监测总数</td>
      <td class="cy_CIASFE_intmonjr">8063</td>
      <td class="cy_CIASFE_intmonzr">8063</td>
    </tr>
    <tr>
      <td>公司舆情</td>
      <td class="cy_CIASFE_intmonjr">0</td>
      <td class="cy_CIASFE_intmonzr">103</td>
    </tr>
    <tr>
      <td>高管舆情</td>
      <td class="cy_CIASFE_intmonjr">203</td>
      <td class="cy_CIASFE_intmonzr">203</td>
    </tr>
    <tr>
      <td>市场动向</td>
      <td class="cy_CIASFE_intmonjr">303</td>
      <td class="cy_CIASFE_intmonzr">303</td>
    </tr>
    <tr>
      <td>国家政策</td>
      <td class="cy_CIASFE_intmonjr">103</td>
      <td class="cy_CIASFE_intmonzr">103</td>
    </tr>
    <tr>
      <td>竞争对手</td>
      <td class="cy_CIASFE_intmonjr">203</td>
      <td class="cy_CIASFE_intmonzr">203</td>
    </tr>
    <tr>
      <td>产品技术</td>
      <td class="cy_CIASFE_intmonjr">303</td>
      <td class="cy_CIASFE_intmonzr">303</td>
    </tr>
    <tr>
      <td>上下游企业</td>
      <td class="cy_CIASFE_intmonjr">103</td>
      <td class="cy_CIASFE_intmonzr">103</td>
    </tr>
    <tr>
      <td>国家政策</td>
      <td class="cy_CIASFE_intmonjr">203</td>
      <td class="cy_CIASFE_intmonzr">203</td>
    </tr>
			</tbody>
		</table>
	</div>	
	<div class="cy_CIASFE_intmonbodyright">
	
<!--条件筛选-->
		<div class="cy_CIASFE_condition">
		  <div class="cy_CIASFE_search">
				<select><option>全文匹配</option></select>
				<div class="cy_CMICBMS_schbox01"><input type="text" v-model="search_key" placeholder="请输入…" style="cursor: text"></div>
				<input type="button" v-on:click="btn_search()" class="cy_CMICBMS_schbtn" value="检索">
			</div>
			<div class="cy_CIASFE_conbox01">监测时间：
			    <input type="radio" name="montime" value="0"  v-model="montime" id="montime_0" style="display: none;" checked><label for="montime_0">今天</label>
				<input type="radio" name="montime" value="-1" v-model="montime" id="montime_1" style="display: none;"><label for="montime_1">24小时</label>
           		<input type="radio" name="montime" value="-2" v-model="montime" id="montime_2" style="display: none;"><label for="montime_2">2天</label>
           		<input type="radio" name="montime" value="-3" v-model="montime" id="montime_3" style="display: none;"><label for="montime_3">3天</label>
           		<input type="radio" name="montime" value="-7" v-model="montime" id="montime_4" style="display: none;"><label for="montime_4">7天</label>
           		<input type="radio" name="montime" value="-10" v-model="montime" id="montime_5" style="display: none;"><label for="montime_5">10天</label>
           		<input type="radio" name="montime" value="10" v-model="montime" id="montime_6" style="display: none;"><label for="montime_6">自定义</label><input type="date" class="cy_CIASFE_timetb">—<input type="date" class="cy_CIASFE_timetb"><input type="button" class="cy_CMICBMS_schbtn" value="确认">
            </div>
		  <div class="cy_CIASFE_conbox02">
				<div class="cy_CIASFE_conbox03">
				情感分析：
					<input type="radio" name="emoana" v-model="emoana" value="-1" id="emoana_0" style="display: none;" checked><label for="emoana_0">全部</label>
					<input type="radio" name="emoana" v-model="emoana" value="0" id="emoana_1" style="display: none;"><label for="emoana_1">正面</label>
					<input type="radio" name="emoana" v-model="emoana" value="1" id="emoana_2" style="display: none;"><label for="emoana_2">中性</label>
					<input type="radio" name="emoana" v-model="emoana" value="2" id="emoana_3" style="display: none;"><label for="emoana_3">负面</label>
				</div>
				<div class="cy_CIASFE_conbox03">相似文章：
					<input type="radio" name="simart" value="0" v-model="simart" id="simart_0" style="display: none;" checked><label for="simart_0">合并</label>
					<input type="radio" name="simart" value="1" v-model="simart" id="simart_1" style="display: none;"><label for="simart_1">不合并</label>
				</div>
			</div>
		  <div class="cy_CIASFE_conbox02">
				<div class="cy_CIASFE_conbox03">排序方式：
					<input type="radio" name="sort" v-model="sort" value="0" id="sort_0" style="display: none;" checked><label for="sort_0">时间降序</label>
					<input type="radio" name="sort" v-model="sort" value="1" id="sort_1" style="display: none;"><label for="sort_1">时间升序</label>
					<input type="radio" name="sort" v-model="sort" value="2" id="sort_2" style="display: none;"><label for="sort_2">权重降序</label>
					<input type="radio" name="sort" v-model="sort" value="3" id="sort_3" style="display: none;"><label for="sort_3">热度排序</label>
				</div>
				<div class="cy_CIASFE_conbox03">信息来源：
					<input type="radio" name="infsour" v-model="infsour" value="-1" id="infsour_0" style="display: none;" checked><label for="infsour_0">全部</label>
					<input type="radio" name="infsour" v-model="infsour" value="0" id="infsour_1" style="display: none;"><label for="infsour_1">新闻</label>
					<input type="radio" name="infsour" v-model="infsour" value="1" id="infsour_2" style="display: none;"><label for="infsour_2">微博</label>
					<input type="radio" name="infsour" v-model="infsour" value="2" id="infsour_3" style="display: none;"><label for="infsour_3">微信</label>
					<input type="radio" name="infsour" v-model="infsour" value="3" id="infsour_4" style="display: none;"><label for="infsour_4">论坛</label>
					<input type="radio" name="infsour" v-model="infsour" value="4" id="infsour_5" style="display: none;"><label for="infsour_5">博客</label>
				</div>
			</div>
	  </div>
	  
<!--	内容-->
	<!--	空数据-->
		<div class="cy_CIASFE_ctnodata">
			<img src="${ctx}/image/fontend-nodata.png">
		</div>
	<!--	详细-->
		<div class="cy_CIASFE_content">
			<div class="cy_CIASFE_contentbox01">
				<label><input type="checkbox" v-model="checked" v-on:click="changeAllChecked()" class="cy_CIASFE_contentall">全选</label>
				
				<input type="button" value="删除" class="cy_CIASFE_contentbtn01">
				<input type="button" value="预警" class="cy_CIASFE_contentbtn01">
			</div>
		</div>
		<div class="cy_CIASFE_prompt">
			您有<span>177</span>条新信息，点击查看
		</div>
		
		<div class="cy_CIASFE_contmain">
		
		<div v-for="(data,index) in datas" class="cy_CIASFE_contpaste" style="border-top: 0px;">
			<div class="cy_CIASFE_contpastetit">
				<label><input type="checkbox" v-bind:value="data.article_ID"  v-model="checkedNames">
				<b>{{data.articleTitle}}</b></label>
				<div v-if="data.emotionDivision=='2'" class="cy_CIASFE_contpassta01">负</div>
				<div v-if="data.earlyWarningState=='1'" class="cy_CIASFE_contpassta01">已预警</div>
				<div class="cy_CIASFE_contpascol">
					<ic_collectiont v-bind:aid="data.article_ID"></ic_collectiont>
					<div class="cy_CIASFE_share" v-bind:data-clipboard-text="data.articleURL" v-bind:id="'sharedv'+index" v-on:click="share(index)"></div>
					<div v-on:click="del_a_article(data.article_ID)" class="cy_CIASFE_dele"></div>
				</div>
				
			</div>
			<div class="cy_CIASFE_contpastecon">
				{{data.articleAbstract}}
			</div>
			
			<div class="cy_CIASFE_contpastfoot">
			    <div v-on:mouseover="simcontent(index)" class="cy_CIASFE_simart">相似文章：{{data.sim_cnt}}条
				<div  class="cy_CIASFE_simartbox">
					<div v-for=" sdata in sim_datas[index]" ><a v-bind:href="sdata.articleURL" target="_blank" >{{sdata.articleTitle}}</a></div>
				</div>
				</div>
			<a target="_blank" v-bind:href="data.articleURL">{{data.releasetime}} {{data.websiteName}}</a>
			
			</div>
			
		</div>
			
		<div ></div>
<!--		分页-->
		<pager ref="pagecomponent"></pager>  <!-- ref 固定为 pagecomponent  -->
		
		</div>
	</div>
</div>	

</div>
<div class="cy_CIASFE_footer02"><a href="">使用手册</a>&nbsp;&nbsp;&nbsp;&nbsp;联系我们（电话：1648726161  邮箱：sales@ichangyun.com）    Copyright&copy;2018-2021 &nbsp;&nbsp;&nbsp;&nbsp;湖北畅云时讯软件技术有限公司版权所有</div>
</div>
</body>
<script type="text/javascript" src="${ctx}/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="${ctx}/layer/layer.js"></script>
<script type="text/javascript" src="${ctx}/js/vue.min.js"></script>
<script type="text/javascript" src="${ctx}/js/axios.min.js"></script>
<script type="text/javascript" src="${ctx}/js/polyfill.min.js"></script>
<script type="text/javascript" src="${ctx}/js/ic_components.js"></script>
<script type="text/javascript" src="${ctx}/js/comm.js"></script>
<script>

var Info = {
		  W0003:'${W0003}',
		  E0004:'${E0004}',
		  E0014:'${E0014}',
		  E0025:'${E0025}',
		  I0011:'${I0011}',
		  I0012:'${I0012}',
		  I0013:'${I0013}',
	      I0019:'${I0019}'
	};


var menu_datas = JSON.parse('${front_menu}') //菜单数据来源于 classes/resources.properties
Vue.component('ic_top_menu',ic_top_menu);   // ic_top_menu 引自 js/ic_component.js

Vue.component('ic_user_info',ic_user_info);  // ic_user_info 引自 js/ic_component.js

Vue.component('ic_collectiont',ic_collectiont); // ic_collectiont 引自 js/ic_component.js

var app = new Vue({
     el:"#app"	,
     data:{
    	 checked: false,      //复选框相关
         checkedNames: [],    //复选框相关
   	     checkedArr: [],      //复选框相关
   	     datas:[],
	     sim_datas:[],   //相似文章
	     search_key:'',
		 montime:'0',  //监测时间
		 emoana:'-1',  //情感分析
		 simart:'0',    //相似文章是否合并
		 sort:'0',     //排序方式
		 infsour:'-1'  //信息来源
     },
     components:{
		     'pager':ic_front_pager  //ic_front_pager 引自 js/ic_components.js
     },
     methods:{
    	 simcontent:function(index){        //获得相似文章
 			if(this.datas[index].sim_cnt>0&&this.sim_datas[index].length==0){
 				var _this = this;
 				axios.get('../thematicmonitoring/getSimContent',{
 	    			params: {
 	    				   Article_ID:_this.datas[index].article_ID
 	    				}
 	    			})
 	    			.then(function (response) {
 	    				var data = JSON.parse(response.data);
 	    				for(var i=0;i<data.length;i++){
 	    					_this.sim_datas[index].push(data[i]);
 	    				}
 	    			
 	    			})
 	    			.catch(function (error) {
 	    			    console.log(error);
 	    			});
 			 }
 			
 		 },
 		 changeAllChecked:function(){
 			  if (!this.checked) {
 					this.checkedNames = this.checkedArr;
 				} else {
 					this.checkedNames = [];
 				}
 		  },
    	 btn_search:function(){
			  this.$refs.pagecomponent.pageBean.pageNow = 1;
			  this.search(this.$refs.pagecomponent.pageBean);
		  },
		  share:function(index){
			 var id = "sharedv"+index;
			 var clipboard = new Clipboard('#'+id);
	         clipboard.on('success', function(e) {
		           layer.msg(Info.I0019);
	          });
			
		 },
		 del_a_article:function(article_ID){
			 
		 }
     },
     watch: {
 		"checkedNames": function() {
 			if (this.checkedNames.length != this.checkedArr.length||this.checkedNames.length==0) {
 				this.checked = false;
 			} else {
 				this.checked = true;
 			}
 		}
 	 },
     computed:{
    	 search:function(){
    		 return function(pageBean){
    			 if(this.montime=='10'){
 	        		this.montime = $("#fromdate").val()+"-"+$("#todate").val();
 	        	 }
    			 var _this = this;
    			 
    			 layer.msg(Info.I0011, {
	        		  icon: 16
	        		  ,shade: 0.01
	        		});
	    		axios.get('../comprehensivemonitoring/search',{
	    			params: {
	    				search_key:_this.search_key.trim(),
	    				montime:_this.montime,
	    				emoana:_this.emoana,
	    				simart:_this.simart,
	    				sort:_this.sort,
	    				infsour:_this.infsour,
	    				pageNow:pageBean.pageNow,
	    				rowSize:pageBean.rs_selected,
	    				}
	    			})
	    			.then(function (response) {
	    				
	    				var data = JSON.parse(response.data);
	    	
	    				_this.$refs.pagecomponent.dealAfterSearch(data.rowCount); 
	    				
	    				_this.datas = data.resdata;
	    				
	    				for(var i=0;i<_this.datas.length;i++){
	    					_this.checkedArr.push(_this.datas[i].article_ID);
	    					_this.sim_datas.push(new Array());
	    				}
	    			
	    				layer.closeAll();
	    			})
	    			.catch(function (error) {
	    			    console.log(error);
	    			});
    			 
    		 }
    	 }
     },
     mounted:function(){
    	 this.search(this.$refs.pagecomponent.pageBean);
     }
 });
</script>
</html>
