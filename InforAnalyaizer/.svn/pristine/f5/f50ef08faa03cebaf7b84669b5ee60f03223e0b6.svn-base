/**
 * Copyright 2018 畅云 http://www.ichangyun.cn
 * <p>
 * 竞争情报分析系统
 */
package com.ichangyun.InforAnalyaizer.controller.thematicmonitoring;

import java.util.Map;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.ModelAndView;

import com.ichangyun.InforAnalyaizer.service.thematicmonitoring.ThematicmonitoringService;

/**
 * 专题监测Controller
 * @author renhao 
 * 2018-11-12 14:52
 */

@RestController
@RequestMapping("/thematicmonitoring")
public class ThematicmonitoringController {

	@Autowired
	private ThematicmonitoringService thematicmonitoringService;
	
	
	/**
	 * 进入到专题监测-信息汇总页面
	 * @return
	 */
	@RequestMapping("/informationaggregation")
	@ResponseBody
	public Object index() {
		return new ModelAndView("thematicmonitoring/informationaggregation");
	}
	
	
	/**
	 * 获得所有的方案
	 * @return
	 */
	@RequestMapping("/getallfa")
	public Object getAllFA() {
		
		String json = thematicmonitoringService.getAllFA();
		
		return json;
	}
	
	/**
	 * 保存新的方案
	 * @param planinfo_name  //方案名称
	 * @param jcc_json       //方案监测词JSON字面量
	 * @param session
	 * @return
	 */
	@RequestMapping("/savenewfa")
	public Object SaveNewfa(@RequestBody Map map,HttpSession session) {
		
		String res = "ok";
		
		String planinfo_name  = (String) map.get("planinfo_name");
		String jcc_json  = (String) map.get("jcc_json");
		String planinfo_removeWord  = (String) map.get("planinfo_removeWord");
		
		if(thematicmonitoringService.exist(planinfo_name)) {
			res = "exist";
		}else {
			if(!thematicmonitoringService.SaveNewfa(planinfo_name,jcc_json,planinfo_removeWord,session)) {
				res = "nok";
			}
		}
		return res;
		
	}
	
	@RequestMapping("/updatefa")
	public Object updatefa(@RequestBody Map map,HttpSession session) {
		String res = "ok";
		
		String plan_id  = (String) map.get("plan_id");
		String planinfo_name  = (String) map.get("planinfo_name");
		String jcc_json  = (String) map.get("jcc_json");
		String planinfo_removeWord  = (String) map.get("planinfo_removeWord");
		
		if(thematicmonitoringService.existwithID(plan_id,planinfo_name)) {
			 res = "exist";
		}else {
			
			if(!thematicmonitoringService.updatefa(plan_id,planinfo_name,jcc_json,planinfo_removeWord,session)) {
				res = "nok";
			}
		}
		
		return res;
	}
	
	/**
	 * 删除方案
	 * @param planid 要删除的方案ID 
	 * @return ok 删除成功  nok  删除失败
	 */
	@RequestMapping("/delfa")
	public Object delfa(String planid) {
		String res = "ok";
		
		if(!thematicmonitoringService.delfa(planid)) {
			res = "nok";
		}
		
		return res;
	}
	
	@RequestMapping("/getDetail")
	public Object getDetail(String planid) {
		
		String json = thematicmonitoringService.getDetail(planid);
		
		return json;
	}
	
}
